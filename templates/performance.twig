<!DOCTYPE html>
<html>
<head>
    <title>Performance Metrics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>Performance Metrics</h1>
        
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Statistics</h5>
                <div id="stats" class="row">
                    <!-- Stats will be loaded via AJAX -->
                </div>
            </div>
        </div>
        
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Endpoint</th>
                    <th>Response Time (ms)</th>
                    <th>Throughput (req/s)</th>
                    <th>Error Rate</th>
                    <th>CPU Usage</th>
                    <th>Memory Usage (MB)</th>
                    <th>Timestamp</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for metric in metrics %}
                <tr>
                    <td>{{ metric.id }}</td>
                    <td>{{ metric.endpoint }}</td>
                    <td>{{ metric.response_time|number_format(2) }}</td>
                    <td>{{ metric.throughput|number_format(2) }}</td>
                    <td>{{ metric.error_rate }}</td>
                    <td>{{ metric.cpu_usage|number_format(2) }}</td>
                    <td>{{ metric.memory_usage|number_format(2) }}</td>
                    <td>{{ metric.timestamp }}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteMetric({{ metric.id }})">Delete</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        {% if totalPages > 1 %}
        <nav>
            <ul class="pagination">
                {% for i in 1..totalPages %}
                <li class="page-item {% if i == currentPage %}active{% endif %}">
                    <a class="page-link" href="?page={{ i }}">{{ i }}</a>
                </li>
                {% endfor %}
            </ul>
        </nav>
        {% endif %}
    </div>
    
    <script>
        // Load stats
        fetch('/stats')
            .then(response => response.json())
            .then(data => {
                document.getElementById('stats').innerHTML = `
                    <div class="col-md-2"><strong>Avg Response Time:</strong> ${parseFloat(data.avg_response_time).toFixed(2)}ms</div>
                    <div class="col-md-2"><strong>Avg Throughput:</strong> ${parseFloat(data.avg_throughput).toFixed(2)} req/s</div>
                    <div class="col-md-2"><strong>Avg Error Rate:</strong> ${parseFloat(data.avg_error_rate).toFixed(2)}</div>
                    <div class="col-md-2"><strong>Avg CPU Usage:</strong> ${parseFloat(data.avg_cpu_usage).toFixed(2)}%</div>
                    <div class="col-md-2"><strong>Avg Memory:</strong> ${parseFloat(data.avg_memory_usage).toFixed(2)}MB</div>
                    <div class="col-md-2"><strong>Total Requests:</strong> ${data.total_requests}</div>
                `;
            });
            
        function deleteMetric(id) {
            if (confirm('Are you sure you want to delete this metric?')) {
                fetch('/metrics/' + id, { method: 'DELETE' })
                    .then(response => {
                        if (response.ok) {
                            location.reload();
                        }
                    });
            }
        }
    </script>
</body>
</html>